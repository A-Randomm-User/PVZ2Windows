<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Excel 链接保留版</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
  body { font-family: Arial; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f5f5f5; }
  a { color: #0078d4; text-decoration: none; }
  a:hover { text-decoration: underline; }
</style>
</head>
<body>
<h2>Excel 数据表（保留超链接文字）</h2>
<div id="tableContainer">正在加载 data.xlsx...</div>

<script>
async function loadExcel() {
  try {
    const response = await fetch('data.xlsx');
    const arrayBuffer = await response.arrayBuffer();
    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];

    // 获取完整的范围
    const range = XLSX.utils.decode_range(sheet['!ref']);
    let html = "<table>";

    for (let R = range.s.r; R <= range.e.r; ++R) {
      html += "<tr>";
      for (let C = range.s.c; C <= range.e.c; ++C) {
        const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
        const cell = sheet[cellAddress];
        let cellContent = "";

        if (cell) {
          // 如果单元格有超链接
          if (cell.l && cell.l.Target) {
            const link = cell.l.Target;
            const text = cell.v || link;
            cellContent = `<a href="${link}" target="_blank">${text}</a>`;
          } else {
            cellContent = cell.v ?? "";
          }
        }

        html += R === 0 ? `<th>${cellContent}</th>` : `<td>${cellContent}</td>`;
      }
      html += "</tr>";
    }

    html += "</table>";
    document.getElementById("tableContainer").innerHTML = html;
  } catch (err) {
    document.getElementById("tableContainer").innerHTML =
      `<p style="color:red;">❌ 无法加载 data.xlsx：${err.message}</p>`;
  }
}

loadExcel();
</script>
</body>
</html>